apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: flix-prod
resources:
  - ../../base/namespace
  - ../../base/redis
  - ../../base/mongodb
  - ../../base/rabbitmq
  - ../../base/eswrapper
  # - ../../base/api-gateway
  # - ../../base/user-service
  - ../../base/catalog-service
  # - ../../base/recommendation-service
  # - ../../base/search-service
  # - ../../base/payment-service
  # - ../../base/frontend
  - rollouts
commonLabels:
  environment: prod
namePrefix: prod-
patches:
  # - path: patches/api-gateway-service.yaml
  #   target:
  #     kind: Service
  #     name: api-gateway
  # - path: patches/api-gateway-configmap.yaml
  #   target:
  #     kind: ConfigMap
  #     name: api-gateway-config
  # - path: patches/user-service-configmap.yaml
  #   target:
  #     kind: ConfigMap
  #     name: user-service-config
  - path: patches/catalog-service-configmap.yaml
    target:
      kind: ConfigMap
      name: catalog-service-config
  # - path: patches/recommendation-service-configmap.yaml
  #   target:
  #     kind: ConfigMap
  #     name: recommendation-service-config
  # - path: patches/search-service-configmap.yaml
  #   target:
  #     kind: ConfigMap
  #     name: search-service-config
  # - path: patches/payment-service-configmap.yaml
  #   target:
  #     kind: ConfigMap
  #     name: payment-service-config
  # - path: patches/frontend-configmap.yaml
  #   target:
  #     kind: ConfigMap
  #     name: frontend-config
  - path: patches/redis-persistence.yaml
    target:
      kind: StatefulSet
      name: redis
patchesStrategicMerge:
  - patches/remove-deployments.yaml
configMapGenerator:
  - name: env-config
    literals:
      - ENVIRONMENT=prod
      - LOG_LEVEL=warn
images:
  # - name: tegar900/flixstream-api-gateway
  #   newTag: latest
  # - name: tegar900/flixstream-user-service
  #   newTag: latest
  - name: tegar900/flixstream-catalog-service
    newTag: "6ddbe66"
# - name: tegar900/flixstream-recommendation-service
#   newTag: latest
# - name: tegar900/flixstream-search-service
#   newTag: latest
# - name: tegar900/flixstream-payment-service
#   newTag: latest
# - name: tegar900/flixstream-frontend
#   newTag: latest
